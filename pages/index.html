<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Задание</title>
    <script type="text/javascript" src="/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/codemirror.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/codemirror.min.css"
    />
    <link rel="stylesheet" href="/theme/dracula.css" />
    <link rel="stylesheet" href="/theme/monokai.css" />
    <style type="text/css">
      table {
        width: 300px; /* Ширина таблицы */
        border-collapse: collapse; /* Убираем двойные линии между ячейками */
      }
      td,
      th {
        padding: 3px; /* Поля вокруг содержимого таблицы */
        border: 1px solid black; /* Параметры рамки */
      }
      th {
        background: #b0e0e6; /* Цвет фона */
      }
    </style>
    <script src="/mode/javascript/javascript.js"></script>
    <script src="/mode/clike/clike.js"></script>
  </head>
  <body>
    <div>
      {{ .Title }}
    </div>
    <div id="container">
      <textarea id="code" cols="60" rows="7"></textarea>
      <input
        type="submit"
        name="preview-form-submit"
        id="preview-form-submit"
        value="Submit"
      />
    </div>

    <div id="results-table"></div>
    <form
      enctype="multipart/form-data"
      id="upload-container"
      method="POST"
      action="/test"
    >
      <!-- <img id="upload-image" src="upload.svg" /> -->
      <!-- <div>
        <input id="file-input" type="file" name="file" multiple />
        <label for="file-input">Выберите файл</label>
        <span>или перетащите его сюда</span>
      </div>
      <input type="submit" value="Send" /> -->
    </form>
  </body>
  <script>
    var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
      lineNumbers: true, // Нумеровать каждую строчку.
      matchBrackets: true,
      mode: "text/x-c++src",
      indentUnit: 2, // Длина отступа в пробелах.
      indentWithTabs: true,
      enterMode: "keep",
      tabMode: "shift",
      theme: "monokai"
    });
    $(document).ready(function() {
      //when form submitted
      $("#preview-form-submit").click(function(e) {
        var value = editor.getValue();
        alert;
        if (value.length == 0) {
          alert("Missing comment!");
          return;
        }
        $.ajax({
          url: "/test",
          type: "POST",
          data: { code: value },
          success: function(verdicts) {
            // alert(verdicts);
            let table = `
               <table>
                    <thead>
                         <th>Название</th>
                         <th>Статус</th>
                         <th>Сообщение</th>
                    </thead>
                    <tbody>`;
            verdicts = JSON.parse(verdicts);
            verdicts.forEach(verdict => {
              table += `<tr>
                    <td>${verdict.name}</td>
                    `;
              if (verdict.status === "OK") {
                table += `<td style='color: green;'>${verdict.status}</td>`;
              } else {
                table += `<td style='color: red;'>${verdict.status}</td>`;
              }
              let message = '';
              if (verdict.message) {
                   message = verdict.message;
              }
              table += `<td>${message}</td>
                    `;
            });
            table += `
                    </tbody>
               </table>`;
            $("#results-table").html(table);
          },
          error: function(xhr, status, error) {
            alert("Ошибка выполнения");
          }
        });
      });
    });
  </script>
</html>
